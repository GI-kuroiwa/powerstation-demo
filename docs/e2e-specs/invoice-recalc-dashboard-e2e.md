# E2Eテスト仕様書: 請求検算ダッシュボード（P-001）

## 対象ページ
- ルート: `/`
- 権限: 認証なし（全員アクセス可）

---

## TC-001: 初期表示
- [x] ページタイトル「PowerStation 請求検算AI」が表示される
- [x] CSVドロップゾーンが表示される
- [x] 「検算開始」ボタンがdisabled状態
- [x] 「サンプルCSV(90件)DL」ボタンが表示・有効
- [x] 処理ルール（折りたたみ）が表示される
- [x] 進捗バー・タブ・結果エリアは非表示

## TC-002: CSVファイル選択
- [x] ドロップゾーンクリックでファイル選択ダイアログが開く
- [x] CSVファイル選択後、ファイル名とサイズが表示される
- [x] ドロップゾーンの枠色が緑に変わる
- [x] 「検算開始」ボタンが有効化される

## TC-003: 複数ファイル拒否
- [x] 複数ファイルをドロップすると「1ファイルずつアップロードしてください」エラー表示
- [x] upload APIは呼ばれない
- [x] CSV以外のファイルは「CSVファイルのみ対応しています」エラー表示

## TC-004: ドラッグ&ドロップ
- [x] CSVファイルをドラッグ中、ドロップゾーンのスタイルが変化（ハイライト）
- [x] ドロップでファイルが選択される
- [x] ドラッグリーブでスタイルが元に戻る

## TC-005: 検算開始
- [x] 「検算開始」クリックで進捗エリアが表示される
- [x] プログレスバーが進行する
- [x] 営業所別ステータスが表示される
- [x] 処理完了後、4タブが表示される
- [x] 「リセット」「例外CSVエクスポート」ボタンが表示される

## TC-006: 全体サマリタブ
- [x] 5つのKPIカード表示（総件数/正常件数/例外件数/例外率/処理時間）
- [x] 正常件数は緑色、例外件数は赤色で表示
- [x] 値が正しい（90/83/7/7.8%/処理時間は実行環境依存）

## TC-007: 営業所別タブ
- [x] 3行のテーブル表示（A/B/C営業所）
- [x] 列: 営業所、件数、例外件数、最多例外コード
- [x] 例外件数が0の行は緑色、1以上は赤色
- [x] 最多例外コードがChipで表示される

## TC-008: 例外一覧タブ
- [x] 7行の例外データが表示される
- [x] 列: 請求番号、営業所、取引先、差額、AI生成理由
- [x] 差額は赤色で表示、+/-符号付き
- [x] 行背景が薄赤ハイライト

## TC-009: 例外内訳展開
- [x] 各行の展開ボタンクリックでアコーディオンが開く
- [x] 基幹値セクション: 税抜小計、税額、税込合計
- [x] AI再計算セクション: 値引後小計、再計算税額、再計算合計
- [x] 値引き情報セクション: 適用値引額、値引方式
- [x] 推奨対応が表示される
- [x] 再度クリックで閉じる

## TC-010: 監査ログタブ
- [x] 90行の全データが表示される
- [x] 列: ハッシュ、請求番号、営業所、ステータス、差額、例外コード、重複スキップ、承認者、処理日時
- [x] OKは緑色Chip、EXCEPTIONは赤色Chip
- [x] テーブルはスクロール可能（stickyHeader）

## TC-011: サンプルCSVダウンロード
- [x] ボタンクリックでCSVファイルがダウンロードされる

## TC-012: 例外CSVエクスポート
- [x] ボタンクリックで例外CSVがダウンロードされる
- [x] ファイル名に"exceptions"を含む

## TC-013: リセット
- [x] 「リセット」クリックでUI状態がクリアされる
- [x] ファイル選択、進捗、結果が初期状態に戻る
- [x] 「検算開始」がdisabledに戻る

## TC-014: 処理ルール折りたたみ
- [x] クリックで展開・5つのルールChipが表示される
- [x] 再クリックで折りたたまれる

## TC-015: レスポンシブ表示
- [x] 1280px以上: フルレイアウト表示
- [x] 768px以下: ボタンが縦並びに変更
- [x] テーブルが横スクロール可能
