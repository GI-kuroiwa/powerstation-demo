# E2Eテスト仕様書: 請求検算ダッシュボード（P-001）

## 対象ページ
- ルート: `/`
- 権限: 認証なし（全員アクセス可）

---

## TC-001: 初期表示
- [ ] ページタイトル「PowerStation 請求検算AI」が表示される
- [ ] CSVドロップゾーンが表示される
- [ ] 「検算開始」ボタンがdisabled状態
- [ ] 「サンプルCSV(90件)DL」ボタンが表示・有効
- [ ] 処理ルール（折りたたみ）が表示される
- [ ] 進捗バー・タブ・結果エリアは非表示

## TC-002: CSVファイル選択
- [ ] ドロップゾーンクリックでファイル選択ダイアログが開く
- [ ] CSVファイル選択後、ファイル名とサイズが表示される
- [ ] ドロップゾーンの枠色が緑に変わる
- [ ] 「検算開始」ボタンが有効化される

## TC-003: 複数ファイル拒否
- [ ] 複数ファイルをドロップすると「1ファイルずつアップロードしてください」エラー表示
- [ ] upload APIは呼ばれない
- [ ] CSV以外のファイルは「CSVファイルのみ対応しています」エラー表示

## TC-004: ドラッグ&ドロップ
- [ ] CSVファイルをドラッグ中、ドロップゾーンのスタイルが変化（ハイライト）
- [ ] ドロップでファイルが選択される
- [ ] ドラッグリーブでスタイルが元に戻る

## TC-005: 検算開始
- [ ] 「検算開始」クリックで進捗エリアが表示される
- [ ] プログレスバーが進行する
- [ ] 営業所別ステータスが表示される
- [ ] 処理完了後、4タブが表示される
- [ ] 「リセット」「例外CSVエクスポート」ボタンが表示される

## TC-006: 全体サマリタブ
- [ ] 5つのKPIカード表示（総件数/正常件数/例外件数/例外率/処理時間）
- [ ] 正常件数は緑色、例外件数は赤色で表示
- [ ] 値が正しい（90/83/7/7.8%/12.3秒）

## TC-007: 営業所別タブ
- [ ] 3行のテーブル表示（A/B/C営業所）
- [ ] 列: 営業所、件数、例外件数、最多例外コード
- [ ] 例外件数が0の行は緑色、1以上は赤色
- [ ] 最多例外コードがChipで表示される

## TC-008: 例外一覧タブ
- [ ] 7行の例外データが表示される
- [ ] 列: 請求番号、営業所、取引先、差額、AI生成理由
- [ ] 差額は赤色で表示、+/-符号付き
- [ ] 行背景が薄赤ハイライト

## TC-009: 例外内訳展開
- [ ] 各行の展開ボタンクリックでアコーディオンが開く
- [ ] 基幹値セクション: 税抜小計、税額、税込合計
- [ ] AI再計算セクション: 値引後小計、再計算税額、再計算合計
- [ ] 値引き情報セクション: 適用値引額、値引方式
- [ ] 推奨対応が表示される
- [ ] 再度クリックで閉じる

## TC-010: 監査ログタブ
- [ ] 90行の全データが表示される
- [ ] 列: ハッシュ、請求番号、営業所、ステータス、差額、例外コード、重複スキップ、承認者、処理日時
- [ ] OKは緑色Chip、EXCEPTIONは赤色Chip
- [ ] テーブルはスクロール可能（stickyHeader）

## TC-011: サンプルCSVダウンロード
- [ ] ボタンクリックでCSVファイルがダウンロードされる

## TC-012: 例外CSVエクスポート
- [ ] ボタンクリックで例外CSVがダウンロードされる
- [ ] ファイル名に"exceptions"を含む

## TC-013: リセット
- [ ] 「リセット」クリックでUI状態がクリアされる
- [ ] ファイル選択、進捗、結果が初期状態に戻る
- [ ] 「検算開始」がdisabledに戻る

## TC-014: 処理ルール折りたたみ
- [ ] クリックで展開・5つのルールChipが表示される
- [ ] 再クリックで折りたたまれる

## TC-015: レスポンシブ表示
- [ ] 1280px以上: フルレイアウト表示
- [ ] 768px以下: ボタンが縦並びに変更
- [ ] テーブルが横スクロール可能
