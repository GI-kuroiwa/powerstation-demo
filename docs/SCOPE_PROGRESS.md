# パワーステーション_デモ 開発進捗状況

## 実装計画

BlueLampでの開発は以下のフローに沿って進行します：

### 開発フェーズ
| フェーズ | 状態 | 解説 |
|---------|:----:|------|
| **Phase 1: 要件定義** | [x] | あなたのアイデアを実現可能な要件に落とし込みます |
| **Phase 2: Git/GitHub管理** | [x] | プロジェクトリポジトリを準備し開発環境を整えます |
| **Phase 3: フロントエンド基盤** | [x] | React+TypeScript+Viteの最新基盤が即座に立ち上がります |
| **Phase 4: ページ実装** | [x] | 画面が一つずつ形になっていきます |
| **Phase 5: 環境構築** | [x] | 本番環境で動作するための秘密鍵を取得し設定します |
| **Phase 6: バックエンド計画** | [x] | 実装の順番を計画し効果的にプロジェクトを組み上げます |
| **Phase 7: バックエンド実装** | [x] | いよいよバックエンドの実装に入ります |
| **Phase 8: API統合** | [ ] | プロトタイプが動くシステムへと変わります |
| **Phase 9: E2Eテスト** | [ ] | ユーザー操作をシミュレートして品質を担保します |
| **Phase 10: 本番運用診断** | [ ] | CVSS 3.1準拠の包括的診断で納品レベルを保証します |
| **Phase 11: デプロイメント** | [ ] | いよいよデプロイ！インターネットに公開します |

### サポートツール（必要に応じて使用）
| ツール | 解説 |
|---------|------|
| **機能拡張** | リリース後も新機能を追加できます |
| **デバッグ** | エラーが発生したら完全自動で解決します |
| **TypeScript型解消** | 型エラーを徹底的に分析し一掃します |
| **リファクタリング** | コード品質を大規模に改善します |
| **ドキュメント生成** | 日本標準の納品ドキュメントを自動生成します |
| **相談** | プロジェクトに関する汎用的な相談やサポートを提供します |

---

## 統合ページ管理表

| ID | ページ名 | ルート | 権限 | 着手 | 完了 |
|----|---------|-------|------|------|------|
| P-001 | 請求検算ダッシュボード | / | 全員（認証なし） | [x] | [x] |

---

## デザインテーマ選定

| # | テーマ名 | 方向性 | 状態 |
|---|---------|-------|:----:|
| 1 | Clean Business | ブルー基調のクリーンなビジネス系 | [x] 作成完了 |
| 2 | Modern Dark | パープルアクセントのダークテーマ | [x] 作成完了 |
| 3 | Earth Tone | ブラウン基調のアースカラー・暖色系 | [x] 作成完了 |
| 4 | Hi-Contrast | オレンジ基調のハイコントラスト・鮮やかアクセント | [x] 作成完了 |

成果物: `mockups/design-theme-selector.html`（タブ切り替え形式で4テーマ比較可能）

---

## バックエンド実装計画

### 垂直スライス依存関係

| 順序 | スライス名 | 主要機能 | 依存 |
|------|-----------|---------|------|
| 1 | インフラ基盤 | FastAPIアプリ / PostgreSQLスキーマ / ヘルスチェック | なし |
| 2-A | サンプルCSV | デモ用90件CSV生成・ダウンロード | インフラ基盤 |
| 2-B | CSV検算コア | アップロード / パース / 計算 / OpenAI理由生成 / 冪等制御 / DB書込 | インフラ基盤 |
| 2-C | SSE進捗配信 | リアルタイム進捗ストリーム / 営業所別ステータス | インフラ基盤 |
| 3-A | 結果取得API | サマリ集約 / 営業所別 / 例外一覧 / 監査ログ | CSV検算コア |
| 3-B | 例外CSVエクスポート | 例外行のみCSV出力 | CSV検算コア |
| 4-B | Google Sheets連携（Optional） | 4シートbatch update | CSV検算コア |
| 4-C | Slack連携（Optional） | 例外通知（Block Kit） | CSV検算コア |

※ 番号-アルファベット表記は並列実装可能（例: 2-A, 2-B, 2-Cは同時実装可能）

### エンドポイント実装タスクリスト

#### スライス1: インフラ基盤

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 1.1 | FastAPIアプリ（main.py, CORS, エラーハンドラ） | - | [x] | [ ] | [ ] | - | [ ] | - |
| 1.2 | PostgreSQLスキーマ（jobs + invoices, raw SQL） | - | [x] | [ ] | [ ] | - | [ ] | - |
| 1.3 | /api/health | GET | [x] | [ ] | [ ] | - | [ ] | [ ] |

#### スライス2-A: サンプルCSVダウンロード

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 2A.1 | /api/sample-csv | GET | [x] | [ ] | [ ] | - | [ ] | [ ] |

#### スライス2-B: CSV検算コア

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 2B.1 | /api/upload（ファイル検証・ハッシュ生成） | POST | [x] | [ ] | [ ] | - | [ ] | [ ] |
| 2B.2 | CSVパース＆数値正規化 | - | [x] | [ ] | [ ] | - | [ ] | - |
| 2B.3 | 計算エンジン（税・値引き・差額判定） | - | [x] | [ ] | [ ] | - | [ ] | - |
| 2B.4 | reason_code決定ロジック | - | [x] | [ ] | [ ] | - | [ ] | - |
| 2B.5 | OpenAI理由生成（例外のみ） | - | [x] | [ ] | [ ] | [ ] | [ ] | - |
| 2B.6 | 冪等制御（hash+invoice_no UNIQUE） | - | [x] | [ ] | [ ] | - | [ ] | - |
| 2B.7 | Job管理（queued→running→done/error） | - | [x] | [ ] | [ ] | - | [ ] | - |

#### スライス2-C: SSE進捗配信

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 2C.1 | /api/stream/{job_id} | GET | [x] | [ ] | [ ] | - | [ ] | [ ] |

#### スライス3-A: 結果取得API

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 3A.1 | /api/result/{job_id} | GET | [x] | [ ] | [ ] | - | [ ] | [ ] |

#### スライス3-B: 例外CSVエクスポート

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 3B.1 | /api/export/exceptions/{job_id}.csv | GET | [x] | [ ] | [ ] | - | [ ] | [ ] |

#### スライス4-B: Google Sheets連携（Optional）

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 4B.1 | 4シートbatch update（upload pipeline統合） | - | [ ] | [ ] | [ ] | [ ] | [ ] | - |

#### スライス4-C: Slack連携（Optional）

| タスク | エンドポイント | メソッド | 実装 | Unit | 内部 | 外部 | 品質 | FE統合 |
|--------|--------------|---------|:----:|:----:|:----:|:----:|:----:|:------:|
| 4C.1 | 例外Slack通知（upload pipeline統合） | - | [ ] | [ ] | [ ] | [ ] | [ ] | - |

**凡例**: 実装=API実装 / Unit=ユニットテスト / 内部=内部結合テスト / 外部=外部結合テスト / 品質=品質担保 / FE統合=フロントエンドAPI統合
**記号**: [ ]=未完了 / [x]=完了 / -=該当なし（外部API未使用）
**外部API**: OpenAI=必須 / Google Sheets=Optional（Phase8以降） / Slack=Optional（Phase8以降）

### フェーズ別スコープ

**Phase 7（バックエンド実装）:** スライス1 / 2-A / 2-B / 2-C / 3-A / 3-B
**Phase 8（API統合）:** FE統合 + スライス4-B（Google Sheets, Optional） + スライス4-C（Slack, Optional）

SlackおよびGoogle Sheets連携はデモ必須機能ではない。Phase7（バックエンド実装）では実装対象外とし、Phase8以降の拡張機能とする。

---

## 付録

### 開発フロー
```
Phase 1: 要件定義 → Phase 2: Git管理 → Phase 3: フロントエンド基盤 → Phase 4: ページ実装
→ Phase 5: 環境構築 → Phase 6: バックエンド計画 → Phase 7: バックエンド実装
→ Phase 8: API統合 → Phase 9: E2Eテスト → Phase 10: 本番運用診断 → Phase 11: デプロイメント

※ サポートツールは必要に応じて適宜使用
```

### 開始手順

開発プロンプトをクリックして次のPhaseを選択し、開発を進めてください。
